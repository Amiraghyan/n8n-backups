{
  "active": false,
  "connections": {
    "WhatsApp Trigger": {
      "main": [
        [
          {
            "node": "Handle Message Types",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Handle Message Types": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Reply To User1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Supabase Vector Store": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Download file": {
      "main": [
        [
          {
            "node": "Supabase Vector Store1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI2": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store1",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Default Data Loader1": {
      "ai_document": [
        [
          {
            "node": "Supabase Vector Store1",
            "type": "ai_document",
            "index": 0
          }
        ]
      ]
    },
    "Recursive Character Text Splitter1": {
      "ai_textSplitter": [
        [
          {
            "node": "Default Data Loader1",
            "type": "ai_textSplitter",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI3": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Reply To User",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-08-27T05:32:45.494Z",
  "id": "KnqI85NvmAEgQgop",
  "isArchived": false,
  "meta": {
    "templateId": "2465",
    "templateCredsSetupCompleted": true
  },
  "name": "WhatsApp Chatbot with SBase RAG",
  "nodes": [
    {
      "parameters": {
        "updates": [
          "messages"
        ],
        "options": {}
      },
      "id": "b53ffabe-3e92-4bd3-bec8-eb7b4f6e326c",
      "name": "WhatsApp Trigger",
      "type": "n8n-nodes-base.whatsAppTrigger",
      "position": [
        2432,
        592
      ],
      "webhookId": "f59fd3c3-4cb4-4701-9041-c349d1f45c85",
      "typeVersion": 1,
      "credentials": {
        "whatsAppTriggerApi": {
          "id": "XkLv4XvqQzbs9ztn",
          "name": "WhatsAppBus"
        }
      }
    },
    {
      "parameters": {
        "operation": "send",
        "phoneNumberId": "={{ $('WhatsApp Trigger').item.json.metadata.phone_number_id }}",
        "recipientPhoneNumber": "={{ $('WhatsApp Trigger').item.json.messages[0].from }}",
        "textBody": "={{ $json.output }}",
        "additionalFields": {
          "previewUrl": false
        }
      },
      "id": "b3386067-4468-4239-a723-0b4090c441f0",
      "name": "Reply To User",
      "type": "n8n-nodes-base.whatsApp",
      "position": [
        3888,
        592
      ],
      "typeVersion": 1,
      "webhookId": "655b8634-1de4-44d9-a65a-6ad06849f570",
      "credentials": {
        "whatsAppApi": {
          "id": "TJd2m4Jje9NwFBEv",
          "name": "WhatsApp account"
        }
      }
    },
    {
      "parameters": {
        "operation": "send",
        "phoneNumberId": "=766212369909166",
        "recipientPhoneNumber": "={{+18585680050}}",
        "textBody": "=I'm unable to process non-text messages. Please send only text messages. Thanks!",
        "additionalFields": {
          "previewUrl": false
        }
      },
      "id": "e695214b-0697-4d27-b8ee-e125827a2197",
      "name": "Reply To User1",
      "type": "n8n-nodes-base.whatsApp",
      "position": [
        2832,
        944
      ],
      "typeVersion": 1,
      "webhookId": "291ad5b5-47ec-402f-b4b5-f986e425f083",
      "credentials": {
        "whatsAppApi": {
          "id": "TJd2m4Jje9NwFBEv",
          "name": "WhatsApp account"
        }
      }
    },
    {
      "parameters": {
        "content": "## 3. Use the WhatsApp Trigger\n[Learn more about the WhatsApp Trigger](https://docs.n8n.io/integrations/builtin/trigger-nodes/n8n-nodes-base.whatsapptrigger/)\n\nThe WhatsApp Trigger allows you to receive incoming WhatsApp messages from customers. It requires a bit of setup so remember to follow the documentation carefully! Once ready however, it's quite easy to build powerful workflows which are easily accessible to users.\n\nNote that WhatsApp can send many message types such as audio and video so in this demonstration, we'll filter them out and just accept the text messages.",
        "height": 484.1875,
        "width": 546.6875,
        "color": 7
      },
      "id": "05a08a08-901d-4ad1-8ef6-8b94b2ccd189",
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2320,
        320
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "### Want to handle all message types?\nCheck out my other WhatsApp template in my creator page! https://n8n.io/creators/jimleuk/",
        "height": 92,
        "width": 338
      },
      "id": "5ac99799-5d56-477b-9d8d-1dec65c60214",
      "name": "Sticky Note3",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2704,
        1152
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "### 3a. Handle Unsupported Message Types\nFor non-text messages, we'll just reply with a simple message to inform the sender.",
        "height": 311.1875,
        "width": 337.6875,
        "color": 7
      },
      "id": "90adb825-d6e1-4e4c-b399-0a134bbe5b1a",
      "name": "Sticky Note4",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2704,
        832
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "## 4. Sales AI Agent Responds To Customers\n[Learn more about using AI Agents](https://docs.n8n.io/integrations/builtin/cluster-nodes/root-nodes/n8n-nodes-langchain.agent/)\n\nn8n's AI agents are powerful nodes which make it incredibly easy to use state-of-the-art AI in your workflows. Not only do they have the ability to remember conversations per individual customer but also tap into resources such as our product catalogue vector store to pull factual information and data for every question.\n\nIn this demonstration, we use an AI agent which is directed to help the user navigate the product brochure. A Chat memory subnode is attached to identify and keep track of the customer session. A Vector store tool is added to allow the Agent to tap into the product catalogue knowledgebase we built earlier.",
        "height": 929.1875,
        "width": 746.6875,
        "color": 7
      },
      "id": "ec4ad124-f1f8-47ee-955c-6a02ceeaaa27",
      "name": "Sticky Note5",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2912,
        192
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "## 5. Repond to WhatsApp User\n[Learn more about the WhatsApp Node](https://docs.n8n.io/integrations/builtin/app-nodes/n8n-nodes-base.whatsapp/)\n\nThe WhatsApp node is the go-to if you want to interact with WhatsApp users. With this node, you can send text, images, audio and video messages as well as use your WhatsApp message templates.\n\nHere, we'll keep it simple by replying with a text message which is the output of the AI agent.",
        "height": 484.1875,
        "width": 495.4375,
        "color": 7
      },
      "id": "21162532-d371-4574-b9b5-f0163bb9ee4d",
      "name": "Sticky Note6",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        3696,
        304
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "## Try It Out!\n\n### This n8n template builds a simple WhatsApp chabot acting as a Sales Agent. The Agent is backed by a product catalog vector store to better answer user's questions.\n\n* This template is in 2 parts: creating the product catalog vector store and building the WhatsApp AI chatbot.\n* A product brochure is imported via HTTP request node and its text contents extracted.\n* The text contents are then uploaded to the in-memory vector store to build a knowledgebase for the chatbot.\n* A WhatsApp trigger is used to capture messages from customers where non-text messages are filtered out.\n* The customer's message is sent to the AI Agent which queries the product catalogue using the vector store tool.\n* The Agent's response is sent back to the user via the WhatsApp node.\n\n### Need Help?\nJoin the [Discord](https://discord.com/invite/XPKeKXeB7d) or ask in the [Forum](https://community.n8n.io/)!",
        "height": 582.6283033962263,
        "width": 401.25
      },
      "id": "442af79e-fd82-4ff5-ab03-7a676b52d94f",
      "name": "Sticky Note7",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        368,
        240
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "version": 2,
                  "leftValue": "",
                  "caseSensitive": true,
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "leftValue": "={{ $json.messages[0].type }}",
                    "rightValue": "text",
                    "id": "f28f9728-76aa-4d57-87e2-ed194aafbdbc"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Supported"
            },
            {
              "conditions": {
                "options": {
                  "version": 2,
                  "leftValue": "",
                  "caseSensitive": true,
                  "typeValidation": "strict"
                },
                "combinator": "and",
                "conditions": [
                  {
                    "id": "89971d8c-a386-4e77-8f6c-f491a8e84cb6",
                    "operator": {
                      "type": "string",
                      "operation": "notEquals"
                    },
                    "leftValue": "={{ $json.messages[0].type }}",
                    "rightValue": "text"
                  }
                ]
              },
              "renameOutput": true,
              "outputKey": "Not Supported"
            }
          ]
        },
        "options": {}
      },
      "id": "1e9cf46d-53e7-4879-9d89-0dd75443aea1",
      "name": "Handle Message Types",
      "type": "n8n-nodes-base.switch",
      "position": [
        2624,
        592
      ],
      "typeVersion": 3.2
    },
    {
      "parameters": {
        "content": "### Activate your workflow to use!\nTo start using the WhatsApp chatbot, you'll need to activate the workflow. If you are self-hosting ensure WhatsApp is able to connect to your server.",
        "height": 107.02804651162779,
        "width": 364.6293255813954,
        "color": 5
      },
      "id": "bccacffe-3f86-4dc4-9701-80202617f0e2",
      "name": "Sticky Note9",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2336,
        832
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.messages[0].text.body }}",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        3056,
        496
      ],
      "id": "f0fd6f94-37b3-4bdb-ad5f-b7691288ad92",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4o",
          "mode": "list",
          "cachedResultName": "gpt-4o"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        2976,
        704
      ],
      "id": "99bca378-3308-4041-91f7-2b8f909f0045",
      "name": "OpenAI Chat Model2",
      "credentials": {
        "openAiApi": {
          "id": "PXmFo7dA7Eis6hfm",
          "name": "AAA OpenAI"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $execution.id }}"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        3072,
        704
      ],
      "id": "1df05af5-ed76-4c42-9d41-76872b7ef1d3",
      "name": "Postgres Memory",
      "credentials": {
        "postgres": {
          "id": "LvaqylKFV62P3ZMU",
          "name": "Agent Memory"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "Use this to get information about 30 AI Saas Ideas",
        "tableName": {
          "__rl": true,
          "value": "documents",
          "mode": "list",
          "cachedResultName": "documents"
        },
        "topK": 20,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        3344,
        704
      ],
      "id": "1b533344-4f01-438f-b555-fa72223cadd2",
      "name": "Supabase Vector Store",
      "credentials": {
        "supabaseApi": {
          "id": "q7V2BY34XfvJcUNp",
          "name": "Agent Vector Store (RAG)"
        }
      }
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": {
          "__rl": true,
          "value": "1ntLCljTDMjjyWsUnMiJr685_D4Kr54G_Cawq4CGc3kg",
          "mode": "list",
          "cachedResultName": "ðŸ’¸ 50 AI SaaS Ideas ðŸ’¸",
          "cachedResultUrl": "https://docs.google.com/document/d/1ntLCljTDMjjyWsUnMiJr685_D4Kr54G_Cawq4CGc3kg/edit?usp=drivesdk"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        2720,
        1408
      ],
      "id": "d9d9b382-5066-4340-a0eb-da0b0e0c5e1e",
      "name": "Download file",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "SXIfgikODHW46SkQ",
          "name": "Google Drive Vector Loader"
        }
      }
    },
    {
      "parameters": {
        "mode": "insert",
        "tableName": {
          "__rl": true,
          "value": "documents",
          "mode": "list",
          "cachedResultName": "documents"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        2928,
        1408
      ],
      "id": "5d99c139-2e7b-4420-81bd-afbe32ec6e4d",
      "name": "Supabase Vector Store1",
      "credentials": {
        "supabaseApi": {
          "id": "q7V2BY34XfvJcUNp",
          "name": "Agent Vector Store (RAG)"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        2832,
        1600
      ],
      "id": "6284b365-f354-48d7-ad59-d4856bf38224",
      "name": "Embeddings OpenAI2",
      "credentials": {
        "openAiApi": {
          "id": "PXmFo7dA7Eis6hfm",
          "name": "AAA OpenAI"
        }
      }
    },
    {
      "parameters": {
        "dataType": "binary",
        "textSplittingMode": "custom",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
      "typeVersion": 1.1,
      "position": [
        3072,
        1536
      ],
      "id": "e4c5429d-5db9-4229-bb41-6979b1315f8b",
      "name": "Default Data Loader1"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter",
      "typeVersion": 1,
      "position": [
        2960,
        1600
      ],
      "id": "2c264913-964c-4913-af2f-86d299031ccf",
      "name": "Recursive Character Text Splitter1"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        3200,
        704
      ],
      "id": "af157b01-fa3e-4d8d-8c7e-4ee6fc52bb12",
      "name": "Embeddings OpenAI3",
      "credentials": {
        "openAiApi": {
          "id": "PXmFo7dA7Eis6hfm",
          "name": "AAA OpenAI"
        }
      }
    }
  ],
  "pinData": {
    "WhatsApp Trigger": [
      {
        "json": {
          "messaging_product": "whatsapp",
          "metadata": {
            "display_phone_number": "15556474769",
            "phone_number_id": "766212369909166"
          },
          "contacts": [
            {
              "profile": {
                "name": "Fausto"
              },
              "wa_id": "18585680050"
            }
          ],
          "messages": [
            {
              "from": "18585680050",
              "id": "wamid.HBgLMTg1ODU2ODAwNTAVAgASGBQzQTlGNjZFNDgzRTEyQTE3MTRCQgA=",
              "timestamp": "1756280439",
              "text": {
                "body": "List the 15th through 20  Saas ideas"
              },
              "type": "text"
            }
          ],
          "field": "messages"
        }
      }
    ]
  },
  "settings": {},
  "shared": [
    {
      "createdAt": "2025-08-27T05:32:45.498Z",
      "updatedAt": "2025-08-27T05:32:45.498Z",
      "role": "workflow:owner",
      "workflowId": "KnqI85NvmAEgQgop",
      "projectId": "yxFGV0GmdwTIiKaD"
    }
  ],
  "staticData": null,
  "tags": [],
  "triggerCount": 1,
  "updatedAt": "2025-09-03T16:07:13.000Z",
  "versionId": "36956a9c-226d-4f62-8020-9490360173d3"
}